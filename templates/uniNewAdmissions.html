    {% load static %} <!-- Load the static template tag -->

    <!DOCTYPE html>
    <html lang="en">
    <head>
        <title>Announce Admissions</title>
        <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" />

        <!-- jQuery library -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>

        <!-- Latest compiled JavaScript -->
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
        <!-- Required meta tags -->
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

        <!-- Bootstrap CSS -->
        <link
            rel="stylesheet"
            href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
            integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
            crossorigin="anonymous"
        />
    </head>
    <style>
        .main {
            background-image: url({% static 'img/bg_students.bbae6663.jpg' %});
        }
        * {
            font-size: large;
            color: #961e64;
        }
        .form-control {
            height: auto !important;
        }
        .input-group-addon,
        .input-group-btn {
            width: auto !important;
        }
    </style>

    <body class="main p-4">
 
    <div class="container">
        <form class="well form-horizontal" action="{% url 'announce_admissions' %}" method="post" id="contact_form">
            {% csrf_token %} <!-- Add CSRF token for form security -->
            <fieldset>
                

                <!-- Form Name -->
                <legend>
                    <a href="{% url 'uniHome' %}" class="btn btn-lg btn-danger">Back</a> 
                         <h3 class="text-right">{{ uniName }}<h3> 
                        {% if messages %}
                            <div class="alert text-center alert-danger">
                                <ul class="list-unstyled">
                                    {% for message in messages %}
                                        <li>{{ message }}</li>
                                    {% endfor %}
                                </ul>
                            </div>
                        {% endif %}
                    <div>
                        <h1 class="text-center">
                            <b>Announce new Admission</b>
                        </h1>
                    </div>
                </legend>
                <hr>
                {% comment %} select campus replaced to year {% endcomment %}
                <div class="form-group">
                    <label class="col-md-4 control-label">Year</label>
                    <div class="col-md-4 selectContainer">
                        <div class="input-group">
                            <span class="input-group-addon"
                                ><i class="glyphicon glyphicon-calendar"></i
                            ></span>
                           <input type="Number" placeholder="Example: 2023" class="form-control" name="campus">
                        </div>
                    </div>
                </div>
                <!-- Select session -->

                <div class="form-group">
                    <label class="col-md-4 control-label">Session</label>
                    <div class="col-md-4 selectContainer">
                        <div class="input-group">
                            <span class="input-group-addon"><i class="glyphicon glyphicon-calendar"></i></span>
                            <select name="session" class="form-control selectpicker">
                                <option value="">Select</option>
                                <option>Fall</option>
                                <option>Spring</option>
                                <option>Winter</option>
                                <option>Fall</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Program -->
                <div class="form-group">
                    <label class="col-md-4 control-label">Choose Program</label>
                    <div class="col-md-4 selectContainer">
                        <div class="input-group">
                            <span class="input-group-addon"><i class="glyphicon glyphicon-list-alt"></i></span>
                            <select name="program" class="form-control selectpicker">
                                <option value="">Select</option>
                                <option>Bachelors/BS</option>
                                <option disabled>MS/M.phil (Coming Soon)</option>
                                <option disabled>Phd (Coming Soon)</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Admission test -->
                <div class="form-group">
                    <label class="col-md-4 control-label">Required Admission test</label>
                    <div class="col-md-4 selectContainer">
                        <div class="input-group">
                            <span class="input-group-addon"><i class="glyphicon glyphicon-pencil"></i></span>
                            <select name="admission_test" class="form-control selectpicker">
                                <option value="">Select</option>
                                <option>Not required</option>
                                <option>Departmental/University</option>
                                <option>NTS NAT</option>
                                <option>NTS GAT</option>
                                <option>HEC HAT 1 </option>
                                <option>HEC HAT 2</option>
                                <option>HEC HAT 3</option>
                                <option>HEC HAT 4</option>
                                <option>HEC USAT </option>
                                <option>HEC USAT </option>
                                <option>ECAT </option>
                                <option>MCAT</option>
                            </select>
                        </div>
                    </div>
                </div>
            
                <!-- Number of students to be shortlisted-->

                <div class="form-group">
                    <label class="col-md-4 control-label">Number of students to be shortlisted</label>
                    <div class="col-md-4 inputGroupContainer">
                    <div class="input-group">
                        <span class="input-group-addon"
                        ><i class="glyphicon glyphicon-asterisk"></i
                        ></span>
                        <input
                        name="no_of_shortlisted_students"
                        placeholder="Example: 50"
                        class="form-control"
                        type="Number"
                        />
                    </div>
                    </div>
                </div>
                
                <!-- Number of students to be shortlisted-->
                <div class="form-group">
                    <label class="col-md-4 control-label">Merit Calculation Formula</label>
                    <div class="col-md-4 inputGroupContainer">
                        <label>Intermedaite required Percentage</label>

                        <div class="input-group">
                            <span class="input-group-addon"
                            ><i class="glyphicon glyphicon-asterisk"></i
                            ></span>
                            <input
                            name="intermediate_required_percentage"
                            placeholder="Example: 50"
                            class="form-control"
                            type="Number"
                            />
                        </div>
                    </div>
                </div>
                <!-- Number of students to be shortlisted-->
                <div class="form-group">
                    <label class="col-md-4 control-label"></label>
                    <div class="col-md-4 inputGroupContainer">
                        <label> Matric required Percentage </label>

                        <div class="input-group">
                            <span class="input-group-addon"
                            ><i class="glyphicon glyphicon-asterisk"></i
                            ></span>
                            <input
                            name="bachelor_required_percentage"
                            placeholder="Example: 50"
                            class="form-control"
                            type="Number"
                            />
                        </div>
                    </div>
                </div>
                <!-- Number of students to be shortlisted-->
                <div class="form-group">
                    <label class="col-md-4 control-label"></label>
                    <div class="col-md-4 inputGroupContainer">
                        <label>Test required Percentage</label>

                        <div class="input-group">
                            <span class="input-group-addon">   <i class="glyphicon glyphicon-asterisk"></i
                            ></span>
                                <input
                                name="test_required_percentage"
                                placeholder="Example: 50"
                                class="form-control"
                                type="Number"
                                />
                        </div>
                    </div>
                </div>


                <div class="form-group">
                    <label class="col-md-4 control-label">Other Requirements</label>
                    <div class="col-md-4 inputGroupContainer">
                        <div class="input-group">
                            <span class="input-group-addon"><i class="glyphicon glyphicon-info-sign"></i></span>
                            <textarea
                                name="other_requirements"
                                placeholder="Enter other requirements here"
                                class="form-control"
                            ></textarea>
                        </div>
                    </div>
                </div>

                                {% comment %} Application fees {% endcomment %}
                <div class="form-group">
                    <label class="col-md-4 control-label">Application Fees</label>
                    <div class="col-md-4 inputGroupContainer">
                        <div class="input-group">
                            <span class="input-group-addon"><i class="glyphicon glyphicon-usd"></i></span>
                            <input
                                name="application_fees"
                                placeholder="Example: 1000"
                                class="form-control"
                                type="number"
                            />
                        </div>
                    </div>
                </div>
                {% comment %} Bank name {% endcomment %}
                <div class="form-group">
                    <label class="col-md-4 control-label">Bank Name</label>
                    <div class="col-md-4 inputGroupContainer">
                        <div class="input-group">
                            <span class="input-group-addon"><i class="glyphicon glyphicon-briefcase"></i></span>
                            <input
                                name="bank_name"
                                placeholder="Example: ABC Bank"
                                class="form-control"
                                type="text"
                            />
                        </div>
                    </div>
                </div>

                {% comment %} account title {% endcomment %}

                <div class="form-group">
                    <label class="col-md-4 control-label">Account Title</label>
                    <div class="col-md-4 inputGroupContainer">
                        <div class="input-group">
                            <span class="input-group-addon"><i class="glyphicon glyphicon-user"></i></span>
                            <input
                                name="account_title"
                                placeholder="Example: University Admissions"
                                class="form-control"
                                type="text"
                            />
                        </div>
                    </div>
                </div>

                {% comment %} account number {% endcomment %}
                <div class="form-group">
                    <label class="col-md-4 control-label">Account Number</label>
                    <div class="col-md-4 inputGroupContainer">
                        <div class="input-group">
                            <span class="input-group-addon"><i class="glyphicon glyphicon-credit-card"></i></span>
                            <input
                                name="account_number"
                                placeholder="Example: 123456789"
                                class="form-control"
                                type="text"
                            />
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="col-md-4 control-label">Start Date</label>
                    <div class="col-md-4 inputGroupContainer">
                        <div class="input-group">
                            <span class="input-group-addon"
                            ><i class="glyphicon glyphicon-calendar"></i
                            ></span>
                            <input
                            name="start_date"
                            placeholder="Example: 50"
                            class="form-control"
                            type="date"
                            />
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="col-md-4 control-label">End Date</label>
                    <div class="col-md-4 inputGroupContainer">
                        <div class="input-group">
                            <span class="input-group-addon"
                            ><i class="glyphicon glyphicon-calendar"></i
                            ></span>
                            <input
                            name="end_date"
                            placeholder="Example: 50"
                            class="form-control"
                            type="date"
                            />
                        </div>
                    </div>
                </div>
                
                                
                <!-- Department-->

                <div class="form-group">
                    <label class="col-md-4 control-label">Departments</label>
                    <div class="col-md-8 inputGroupContainer">
                        <div class="checkboxes">
                            <label class="checkbox-inline">
                                <input type="checkbox" name="department" value="Computer Science" /> Computer Science
                            </label>
                            <label class="checkbox-inline">
                                <input type="checkbox" name="department" value="Mathematics" /> Mathematics
                            </label>
                            <label class="checkbox-inline">
                                <input type="checkbox" name="department" value="BBA" /> BBA
                            </label>
                            <!-- Add more department options as needed -->
                        </div>
                    </div>
                </div>

                
                <hr />
                
                <!-- Button -->
                <div class="form-group">
                    <label class="col-md-4 control-label"></label>
                    <div class="col-md-4 text-center">
                        <button type="submit" class="btn btn-lg btn-warning">Announce Admissions</button>
                    </div>
                </div>
            </fieldset>
        </form>
    </div>


    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    </body>
    </html>


    <script>
$(document).ready(function () {
    // Function to handle changes in admission test option
    $("select[name='admission_test']").change(function () {
        var admissionTest = $(this).val();
        if (admissionTest === "Not required") {
            $("input[name='test_required_percentage']").val(0);
            $("input[name='test_required_percentage']").prop("readonly", true);

            // When the test is not required, calculate and display matric percentage based on intermediate
            var intermediatePercentage = parseFloat($("input[name='intermediate_required_percentage']").val()) || 0;
            var matricPercentage = 100 - intermediatePercentage;
            $("input[name='bachelor_required_percentage']").val(matricPercentage.toFixed(2));
            // Make the auto-driven matric percentage non-editable
            $("input[name='bachelor_required_percentage']").prop("readonly", true);
        } else {
            // When the test is required, reset test percentage to zero and make it editable
            $("input[name='test_required_percentage']").val("");
            $("input[name='test_required_percentage']").prop("readonly", true);

            // Calculate and display test percentage based on the remaining percentage from intermediate and matric
            var intermediatePercentage = parseFloat($("input[name='intermediate_required_percentage']").val()) || 0;
            var matricPercentage = parseFloat($("input[name='bachelor_required_percentage']").val()) || 0;
            var testPercentage = 100 - intermediatePercentage - matricPercentage;
            $("input[name='test_required_percentage']").val(testPercentage.toFixed(2));
            // Make the auto-driven test percentage non-editable
            $("input[name='test_required_percentage']").prop("readonly", true);
        }
    });

    // Function to handle changes in intermediate percentage
    $("input[name='intermediate_required_percentage']").keyup(function () {
        var intermediatePercentage = parseFloat($(this).val()) || 0;
        if ($("select[name='admission_test']").val() === "Not required") {
            var matricPercentage = 100 - intermediatePercentage;
            $("input[name='bachelor_required_percentage']").val(matricPercentage.toFixed(2));
            $("input[name='bachelor_required_percentage']").prop("readonly", true);
        } else {
            // When the test is required, recalculate and display test percentage based on the remaining percentage from intermediate and matric
            var matricPercentage = parseFloat($("input[name='bachelor_required_percentage']").val()) || 0;
            var testPercentage = 100 - intermediatePercentage - matricPercentage;
            $("input[name='test_required_percentage']").val(testPercentage.toFixed(2));
            // Make the auto-driven test percentage non-editable
            $("input[name='test_required_percentage']").prop("readonly", true);
        }
    });

    // Function to handle changes in matric percentage
    $("input[name='bachelor_required_percentage']").keyup(function () {
        var matricPercentage = parseFloat($(this).val()) || 0;
        if ($("select[name='admission_test']").val() === "Not required") {
            var intermediatePercentage = 100 - matricPercentage;
            $("input[name='intermediate_required_percentage']").val(intermediatePercentage.toFixed(2));
           // $("input[name='intermediate_required_percentage']").prop("readonly", true);
        } else {
            // When the test is required, recalculate and display test percentage based on the remaining percentage from intermediate and matric
            var intermediatePercentage = parseFloat($("input[name='intermediate_required_percentage']").val()) || 0;
            var testPercentage = 100 - intermediatePercentage - matricPercentage;
            $("input[name='test_required_percentage']").val(testPercentage.toFixed(2));
            // Make the auto-driven test percentage non-editable
            $("input[name='test_required_percentage']").prop("readonly", true);
        }
    });

    // Function to handle form submission
    $("#contact_form").submit(function (event) {
        // Validate start and end date
        var startDate = new Date($("input[name='start_date']").val());
        var endDate = new Date($("input[name='end_date']").val());
        var today = new Date();

        if (today == startDate && today <= endDate) {
            alert("Invalid start or end date");
            event.preventDefault(); // Prevent form submission
        }

        // Validate all visible fields to ensure they are not empty
        var formIsValid = true;
        $("form#contact_form :input:visible").not(":button").each(function () {
            if ($(this).val().trim() === "") {
                alert("All fields must be filled out");
                formIsValid = false;
                return false; // Exit the loop early
            }
        });

        // Validate total percentage
        var totalPercentage = parseFloat($("input[name='intermediate_required_percentage']").val()) || 0;
        totalPercentage += parseFloat($("input[name='bachelor_required_percentage']").val()) || 0;
        totalPercentage += parseFloat($("input[name='test_required_percentage']").val()) || 0;

        if (totalPercentage > 100 ||totalPercentage < 0) {
            alert("Total percentage cannot exceed 100%");
            formIsValid = false;
        }

        if (!formIsValid) {
            event.preventDefault(); // Prevent form submission
        }
    });
});
$("select[name='admission_test']").change(function () {
    var admissionTest = $(this).val();
    if (admissionTest === "Not required") {
        $("input[name='test_required_percentage']").val(0);
        $("input[name='test_required_percentage']").prop("readonly", true);

        // When the test is not required, calculate and display matric percentage based on intermediate
        var intermediatePercentage = parseFloat($("input[name='intermediate_required_percentage']").val()) || 0;
        var matricPercentage = 100 - intermediatePercentage;
        $("input[name='bachelor_required_percentage']").val(matricPercentage.toFixed(2));
        // Make the auto-driven matric percentage non-editable
        $("input[name='bachelor_required_percentage']").prop("readonly", true);
    } else {
        // When the test is required, reset test percentage to zero and make it editable
        $("input[name='test_required_percentage']").val("");
        $("input[name='test_required_percentage']").prop("readonly", false);

        // Reset matric percentage to an empty state and make it editable
        $("input[name='bachelor_required_percentage']").val("");
        $("input[name='bachelor_required_percentage']").prop("readonly", false);
    }
});

</script>
